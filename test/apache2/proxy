#
# $Id$
#
# An apache2 virtualhost configuration to do pass-through proxying to
# the upstream Ubuntu and Debian archives.  This makes the host machine
# look like an actual archive server to the client instances, and avoids
# the need to explicitly declare an http_proxy to the installer.
# apt-get and d-i have issues with pipelining to squid caches - proxying
# this way avoids those issues.

NameVirtualHost 192.168.23.1
<VirtualHost 192.168.23.1>
  ServerName www.localnet
  ProxyRequests Off
  ProxyPreserveHost Off

  CacheRoot "/var/www/proxy"
  CacheMaxExpire 24
  CacheLastModifiedFactor 0.1
  CacheDefaultExpire 1


  <Proxy *>
    Order deny,allow
    Allow from 192.168.23.0/24
  </Proxy>

  <Directory /debian/>
    ProxyPass http://ftp.us.debian.org/debian/
    ProxyPassReverse http://ftp.us.debian.org/debian/
    Allow from 192.168.23.0/24
  </Directory>

  <Directory /debian-security/>
    ProxyPass http://security.debian.org/debian-security/
    ProxyPassReverse http://security.debian.org/debian-security/
    Allow from 192.168.23.0/24
  </Directory>

  <Directory /ubuntu/>
    ProxyPass http://archive.ubuntu.com/ubuntu/
    ProxyPassReverse http://archive.ubuntu.com/ubuntu/
    Allow from 192.168.23.0/24
  </Directory>

  LogLevel warn
  CustomLog /var/log/apache2/proxy.log combined

</VirtualHost>
